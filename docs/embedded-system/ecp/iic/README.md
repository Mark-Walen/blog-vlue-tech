---
title: 理解 I2C 总线
date: 2024-01-03
headerDepth: 2
description: 本文主要介绍了 I2C 接口通信
---

## 思维导图

## 简介

Inter-Integrated Circuit（$\text{I}^2\text{C}$）总线是由飞利浦公司最初为消费品开发的一种双线串行接口。它是一种半双工总线，可以轻松在任何 IC 工艺（NMOS、CMOS、双极）中实现，并允许简单的IC间通信。通过使用串行数据线（SDA）、串行时钟线（SCL）和共同的地线来进行所有通信，可以最小化连接。$\text{I}^2\text{C}$ 已经得到了广泛的接受，并且甚至作为系统管理总线（SMBus）的原型，SMBus 是 $\text{I}^2\text{C}$ 的一个子集。

## 电子特性

$\text{I}^2\text{C}$ 使用开漏[^open-drain]/开集[^open-collector]电极结构，并在同一条线上具有输入缓冲器，这使得可以使用单个数据线进行双向数据流。

### 开漏用于双向通信

在总线被主设备或从设备释放的情况下，线上的上拉电阻（$R_{PU}$）负责将总线电压拉高到电源轨。由于没有设备可以强制将线上的电压保持高电平，这意味着总线永远不会遇到通信问题，其中一个设备可能尝试发送高电平，而另一个发送低电平，从而导致短路（电源轨到地）。$\text{I}^2\text{C}$要求在多主环境中，如果主设备发送高电平，但看到总线处于低电平状态（另一个设备正在拉低它），则停止通信，因为另一个设备正在使用总线。推挽（push-pull）接口不允许这种自由度，这是$\text{I}^2\text{C}$的一个优点。

![basic_of_sda_scl_structure](./img/basic_of_sda_scl_structure.png "图 2. SDA/SCL 线的基本内部结构")

图 2 显示了SDA/SCL线上从设备或主设备的内部结构的简化视图，包括用于读取输入数据的缓冲区和用于传输数据的下拉场效应晶体管（FET）。**设备只能将总线线拉低（提供短接到地）或释放总线线（高阻抗到地），并允许上拉电阻将电压提高**。 这是处理I2C设备时要意识到的一个重要概念，因为没有设备可以将总线线保持高电平。这个特性是实现双向通信的关键。

#### 开漏下拉

如上所述，开漏设置只能将总线拉低，或者“释放”它并让一个电阻将其拉高。图 3 显示了拉低总线的电流流动。想要传输低电平的逻辑将激活下拉场效应晶体管，它会提供一个通向地的短路，将总线拉低。

![image-20240104170645795](/assets/img/ecp/iic/od_pulling_low.png "图 3. 使用开漏接口拉低总线")

#### 开漏释放总线

当从设备或主设备希望发送逻辑高电平时，它只能通过关闭下拉场效应晶体管来释放总线。这会使总线悬空，上拉电阻将电压拉高到电压轨，被解释为高电平。图4显示了通过上拉电阻的电流流向，将总线拉高。

![image-20240104171501157](/assets/img/ecp/iic/release_bus_od.png "图 4. 使用开漏接口释放总线")

## 术语

[^open-drain]: 开漏: 一种输出类型，开漏输出可以将信号线拉低到某个电压（在大多数情况下是地线）（逻辑0），但不能将其拉高到逻辑1。为了实现高状态，需要外部上拉电阻。当输出处于高阻态时，上拉电阻将信号线拉到高电平。
[^open-collector]: 开集: 类似于开漏，开集电极输出可以将信号线拉低，但需要外部上拉电阻将线拉高。主要区别在于使用的技术（晶体管类型）。
